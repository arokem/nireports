<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="MRIQC" />
<title>MRIQC: individual {{ modality }}
report</title>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script>
function download() {
    var ds = "{{ dataset }}"
    var sub = "{{ bids_name }}"
    var reportlets = []

    var els = document.getElementsByClassName("rating-form")
    for (var elid = 0; elid < els.length; elid++) {
        // Do stuff here
        var thisrep = {}
        for (var i = 0; i < els[elid].children.length; i++) {
            thisrep[els[elid].children[i].name] = els[elid].children[i].value
        }

        reportlets.push(thisrep)
    };

    var file = new Blob([JSON.stringify({
        'dataset': ds,
        'subject': sub,
        'reports': reportlets}
    )], {type: 'text/json'});

    var a = document.getElementById("a");
    a.href = URL.createObjectURL(file);
    a.download = ds + "_" + sub + ".json";
    a.style.visibility = "visible"
}
</script>
<style type="text/css">
body {
  font-family: helvetica;
  padding: 50px 10px 10px;
}

div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
}

span.problematic {
  color: red;
  font-weight: bold ;
}

p.label {
  white-space: nowrap }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

div.embeded-report {
  width: 100%;
  page-break-before:always;
  padding-top: 20px;
}

div.embeded-report svg { width: 100%; }

span.qa-fail {
  color: white;
  font-weight: bold;
  background-color: #FF6347;
}

span.qa-pass {
  color: white;
  font-weight: bold;
  background-color: #32CD32;
}

h1 { margin-top: 30px; }
h2 { margin-top: 20px; }

div#accordionOther {
  margin: 0 20px;
}

</style>
</head>
<body>
<div class="document">

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
<div class="collapse navbar-collapse">
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link" href="#summary">Summary</a></li>
      <li class="nav-item"><a class="nav-link" href="#visuals">Visual reports</a></li>
      <li class="nav-item"><a class="nav-link" href="#other">Other</a></li>
      <li class="nav-item"><a class="nav-link" href="#feedback">Rate image</a></li>
    </ul>
</div>
</nav>

<noscript>
    <h1 class="text-danger"> The navigation menu uses Javascript. Without it this report might not work as expected </h1>
</noscript>

<h1>MRIQC: individual {{ modality }}
report</h1>

<h2 id="summary">Summary</h2>
<ul class="simple">
<li>Subject ID: {{ sub_id }}.</li>
{% if pred_qa is not none %}
<li>MRIQC predicted QA:
{% if pred_qa > 0 %}<span class="qa-fail">Exclude</span>
{% else %}<span class="qa-pass">Pass</span>
{% endif %}
</li>
{% endif %}
<li>Date and time: {{ timestamp }}.</li>
<li>MRIQC version: {{ version }}.</li>
{% if workflow_details %}
<li>Workflow details:
  <ul class="sub-simple">
  {% for detail in workflow_details %}
  <li>{{ detail }}</li>
  {% endfor %}
  </ul>
</li>
{% endif %}
</ul>

<h2 id="visuals">Visual reports</h2>
{% for title, svg in svg_files %}
<div class="embeded-report">
  <h3>{{ title }}</h3>
{{ svg }}
</div>
{% endfor %}

<h2 id="other">Other</h2>
<div class="accordion" id="accordionOther">
  <div class="card">
    <div class="card-header" id="headingOne">
      <h5 class="mb-0">
        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
          Extracted Image Quality Metrics (IQMs)
        </button>
      </h5>
    </div>

    <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionOther">
      <div class="card-body metadata-table">
      {{ imparams }}
      </div>
    </div>
  </div>
{% if metadata %}
  <div class="card">
    <div class="card-header" id="headingTwo">
      <h5 class="mb-0">
        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
          Metadata
        </button>
      </h5>
    </div>
    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionOther">
      <div class="card-body metadata-table">
      {{ metadata }}
      </div>
    </div>
  </div>
{% endif %}
{% if provenance %}
  <div class="card">
    <div class="card-header" id="headingThree">
      <h5 class="mb-0">
        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          Provenance information
        </button>
      </h5>
    </div>
    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionOther">
      <div class="card-body provenance-table">
      {{ provenance }}
      </div>
    </div>
  </div>
</div>
{% endif %}

{% if provenance %}
<h2 id="feedback">Rate Image</h2>

<div class="rating-form">
<input type="hidden" value="overall" name="name" />
<select name="rating">
  <option value="-1">(unrated)</option>
  <option value="0">Useless</option>
  <option value="1">Poor result</option>
  <option value="2">Acceptable</option>
  <option value="3">Exceptional</option>
</select>
<textarea rows="2" cols="100" name="comment">
</textarea>
</div>

<button onclick="download()">Create file</button>
<a href="" id="a" style="visibility:hidden">Save your ratings</a>
<br />
<br />


<script type="text/javascript">
    function toggle(id) {
        var element = document.getElementById(id);
        if(element.style.display == 'block')
            element.style.display = 'none';
        else
            element.style.display = 'block';
    }
</script>
</body>
</html>
